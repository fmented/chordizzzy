function setLow(e){lo=e,t.innerHTML="Press the highest note"}function setHigh(e){t.innerHTML="Generating Chord list",setTimeout(function(){hi=e,chord=getChordList()},4e3)}function onFailed(){t.innerHTML="This Browser Doesn't Support MIDI"}function compare(e,n){if(e.toString()==n.toString())return!0}function onMIDISuccess(e){var n=[];for(var a of e.inputs.values())a.onstatechange=function(){"open"==this.connection?(lo=void 0,hi=void 0,t.innerHTML="Press the lowest note"):(n.splice(n.indexOf(a.name),1),setTimeout(function(){n.length<1&&(t.innerHTML="No MIDI Device")},100))},a.onmidimessage=getMIDIMessage}function getChordList(){var e,n,a,s,m,o,y,k,i,r={};return chords.forEach(function(t){for(var u=lo;u<hi;u++){var d=add(t.keys,u);e=d[1]+t.name,n=d[0],Math.max(...n)<=hi&&null==r[n]&&(r[n]=e);for(var l=lo;l<=hi;l++)if(l<u){if(l%12!=u%12){d=addSlash(t.keys,u,l);e=d[1]+t.name+"/"+d[2],n=d[0],Math.max(...n)<=hi&&null==r[n]&&(r[n]=e)}chords.forEach(d=>{a=d.keys,s=add(a,l),m=add(t.keys,u),o=s[0],k=s[1],y=m[0],i=m[1],n=o.concat(y).sort(function(e,n){return e-n}),e=i+t.name+"/"+k+d.name,Math.max(...n)<=hi&&null==r[n]&&(r[n]=e)})}}}),t.innerHTML="Ready",r}function getMIDIMessage(e){var n=e.data[1];if(144==e.data[0]){if(null==lo&&null==hi)setLow(n);else if(null!=lo&&null==hi)setHigh(n);else if(played.push(n),1==played.length)played[0]<=hi&&(t.innerHTML=notes[played[0]%12]);else if(p=played.sort(function(e,n){return e-n}),null!=chord[p.toString()]){t.innerHTML=chord[p.toString()];try{clearTimeout(tm)}catch(e){console.log(e)}}}else played.splice(played.indexOf(n),1),null!=hi&&null!=lo&&(t.innerHTML="",0==played.length&&(tm=setTimeout(function(){t.innerHTML="Waiting MIDI Input"},5e3)))}function add(e,n){for(var a=[],s=0;s<e.length;s++)a.push(e[s]+n);return[a.sort(function(e,n){return e-n}),notes[Math.floor(n%12)]]}function addSlash(e,n,a){for(var s=[],m=0;m<e.length;m++)s.push(e[m]+n);return s.sort(function(e,n){return e-n}),s.unshift(a),[s,notes[Math.floor(n%12)],notes[Math.floor(a%12)]]}var chord,lo,hi,midisupport,tm,p,t=document.getElementById("txt"),played=[],notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],chords=[{name:"M",keys:[0,4,7]},{name:"Maj7",keys:[0,4,7,11]},{name:"Maj9",keys:[0,4,7,11,14]},{name:"Maj9",keys:[0,2,4,7,11]},{name:"6",keys:[0,4,7,9]},{name:"6/9",keys:[0,4,7,9,14]},{name:"6/9",keys:[0,2,4,7,9]},{name:"Maj7#11",keys:[0,4,6,7,11]},{name:"Maj7#11",keys:[0,4,7,11,18]},{name:"Maj13",keys:[0,4,7,11,21]},{name:"Maj13",keys:[0,4,7,9,11]},{name:"m",keys:[0,3,7]},{name:"minMaj7",keys:[0,3,7,11]},{name:"min9",keys:[0,3,7,11,13]},{name:"min9",keys:[0,2,3,7,11]},{name:"m6",keys:[0,3,7,9]},{name:"m6/9",keys:[0,3,7,9,13]},{name:"m6/9",keys:[0,2,3,7,9]},{name:"min7#11",keys:[0,3,6,7,11]},{name:"min7#11",keys:[0,3,7,11,18]},{name:"min13",keys:[0,3,7,11,21]},{name:"min13",keys:[0,3,7,9,11]},{name:"7",keys:[0,4,7,10]},{name:"m7",keys:[0,3,7,10]},{name:"sus2",keys:[0,2,7]},{name:"sus4",keys:[0,5,7]},{name:"add9",keys:[0,4,7,14]},{name:"add9",keys:[0,2,4,7]},{name:"5",keys:[0,7]},{name:"Dim",keys:[0,3,6]},{name:"Aug",keys:[0,4,8]},{name:"M-5",keys:[0,4,6]},{name:"Maj7-5",keys:[0,4,6,11]},{name:"Maj9-5",keys:[0,4,6,11,14]},{name:"Maj9-5",keys:[0,2,4,6,11]},{name:"6-5",keys:[0,4,6,9]},{name:"6/9-5",keys:[0,4,6,9,14]},{name:"6/9-5",keys:[0,2,4,6,9]},{name:"Maj13-5",keys:[0,4,6,11,21]},{name:"Maj13-5",keys:[0,4,6,9,11]},{name:"m-5",keys:[0,3,6]},{name:"minMaj7-5",keys:[0,3,6,11]},{name:"min9-5",keys:[0,3,6,11,13]},{name:"min9-5",keys:[0,2,3,6,11]},{name:"m6-5",keys:[0,3,6,9]},{name:"m6/9-5",keys:[0,3,6,9,13]},{name:"m6/9-5",keys:[0,2,3,6,9]},{name:"min13-5",keys:[0,3,6,11,21]},{name:"min13-5",keys:[0,3,6,9,11]},{name:"7-5",keys:[0,4,6,10]},{name:"m7-5",keys:[0,3,6,10]},{name:"sus2-5",keys:[0,2,6]},{name:"sus4-5",keys:[0,5,6]},{name:"add9-5",keys:[0,4,6,14]},{name:"add9-5",keys:[0,2,4,6]},{name:"M+5",keys:[0,4,8]},{name:"Maj7+5",keys:[0,4,8,11]},{name:"Maj9+5",keys:[0,4,8,11,14]},{name:"Maj9+5",keys:[0,2,4,8,11]},{name:"6+5",keys:[0,4,8,9]},{name:"6/9+5",keys:[0,4,8,9,14]},{name:"6/9+5",keys:[0,2,4,8,9]},{name:"Maj13+5",keys:[0,4,8,11,21]},{name:"Maj13+5",keys:[0,4,8,9,11]},{name:"m+5",keys:[0,3,8]},{name:"minMaj7+5",keys:[0,3,8,11]},{name:"min9+5",keys:[0,3,8,11,13]},{name:"min9+5",keys:[0,2,3,8,11]},{name:"m6+5",keys:[0,3,8,9]},{name:"m6/9+5",keys:[0,3,8,9,13]},{name:"m6/9+5",keys:[0,2,3,8,9]},{name:"min13+5",keys:[0,3,8,11,21]},{name:"min13+5",keys:[0,3,8,9,11]},{name:"7+5",keys:[0,4,8,10]},{name:"m7+5",keys:[0,3,8,10]},{name:"sus2+5",keys:[0,2,8]},{name:"sus4+5",keys:[0,5,8]},{name:"add9+5",keys:[0,4,8,14]},{name:"add9+5",keys:[0,2,4,8]},{name:"M(no5)",keys:[0,4]},{name:"Maj7(no5)",keys:[0,4,11]},{name:"Maj9(no5)",keys:[0,4,11,14]},{name:"Maj9(no5)",keys:[0,2,4,11]},{name:"6(no5)",keys:[0,4,9]},{name:"6/9(no5)",keys:[0,4,9,14]},{name:"6/9(no5)",keys:[0,2,4,9]},{name:"Maj13(no5)",keys:[0,4,11,21]},{name:"Maj13(no5)",keys:[0,4,9,11]},{name:"m(no5)",keys:[0,3]},{name:"minMaj7(no5)",keys:[0,3,11]},{name:"min9(no5)",keys:[0,3,11,13]},{name:"min9(no5)",keys:[0,2,3,11]},{name:"m6(no5)",keys:[0,3,9]},{name:"m6/9(no5)",keys:[0,3,9,13]},{name:"m6/9(no5)",keys:[0,2,3,9]},{name:"min13(no5)",keys:[0,3,11,21]},{name:"min13(no5)",keys:[0,3,9,11]},{name:"7(no5)",keys:[0,4,10]},{name:"m7(no5)",keys:[0,3,10]},{name:"sus2(no5)",keys:[0,2]},{name:"sus4(no5)",keys:[0,5]},{name:"add9(no5)",keys:[0,4,14]},{name:"add9(no5)",keys:[0,2,4]},{name:"M9(no7)",keys:[0,4,7,14]},{name:"M9(no7)",keys:[0,2,4,7]},{name:"Maj7#11(no7)",keys:[0,4,6,7]},{name:"Maj7#11(no7)",keys:[0,4,7,18]},{name:"Maj13(no7)",keys:[0,4,7,21]},{name:"Maj13(no7)",keys:[0,4,7,9]},{name:"m9(no7)",keys:[0,3,7,14]},{name:"m9(no7)",keys:[0,2,3,7]},{name:"min7#11(no7)",keys:[0,3,6,7]},{name:"min7#11(no7)",keys:[0,3,7,18]},{name:"min13(no7)",keys:[0,3,7,21]},{name:"min13(no7)",keys:[0,3,7,9]}];navigator.permissions.query({name:"midi"}).then(e=>{"granted"==e.state&&navigator.requestMIDIAccess().then(onMIDISuccess,onFailed)});